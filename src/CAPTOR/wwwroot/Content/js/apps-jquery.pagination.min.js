(function(n,t,i){n.fn.paging=function(r,u){var e=this,f={setOptions:function(r){var u=function(n){for(var s=0,u=0,e=1,r={fstack:[],asterisk:0,inactive:0,blockwide:5,current:3,rights:0,lefts:0},t,h=/[*<>pq\[\]().-]|[nc]+!?/g,o={"[":"first","]":"last","<":"prev",">":"next",q:"left",p:"right","-":"fill",".":"leap"},f={};t=h.exec(n);)t=""+t,i===o[t]?"("===t?u=++s:")"===t?u=0:e&&("*"===t?(r.asterisk=1,r.inactive=0):(r.asterisk=0,r.inactive="!"===t.charAt(t.length-1),r.blockwide=t.length-r.inactive,(r.current=1+t.indexOf("c"))||(r.current=1+r.blockwide>>1)),r.fstack.push({ftype:"block",fgroup:0,fpos:0}),e=0):(r.fstack.push({ftype:o[t],fgroup:u,fpos:i===f[t]?f[t]=1:++f[t]}),"q"===t?++r.lefts:"p"===t&&++r.rights);return r};return f.opts=n.extend(f.opts||{lapping:0,perpage:10,page:1,refresh:{interval:10,url:null},format:"",lock:!1,circular:!1,onClick:null,onFormat:function(){},onSelect:function(){return!0},onRefresh:function(){}},r||{}),f.opts.lapping|=0,f.opts.perpage|=0,f.opts.page!==null&&(f.opts.page|=0),f.opts.perpage<1&&(f.opts.perpage=10),f.interval&&t.clearInterval(f.interval),f.opts.refresh.url&&(f.interval=t.setInterval(function(){n.ajax({url:f.opts.refresh.url,success:function(t){if(typeof t=="string")try{t=n.parseJSON(t)}catch(i){return}f.opts.onRefresh(t)}})},1e3*f.opts.refresh.interval)),f.format=u(f.opts.format),f},setNumber:function(n){return f.number=i===n||n<0?-1:n,f},setPage:function(r){function k(n,t,i){i=""+n.onFormat.call(t,i);w+=t.value?i.replace(/<a/i,'<a data-page="'+t.value+'"'):i}if(f.opts.lock){f.opts.onSelect(0,e);return f}if(i===r){if(r=f.opts.page,null===r)return f}else if(f.opts.page==r)return f;f.opts.page=r|=0;var v=f.number,h=f.opts,a,y,o,w,d=1,s=f.format,u,c,l,p,g=s.fstack.length,b=g;for(h.perpage<=h.lapping&&(h.lapping=h.perpage-1),p=v<=h.lapping?0:h.lapping|0,v<0?(v=-1,o=-1,a=Math.max(1,r-s.current+1-p),y=a+s.blockwide):(o=1+Math.ceil((v-h.perpage)/(h.perpage-p)),r=Math.max(1,Math.min(r<0?1+o+r:r,o)),s.asterisk?(a=1,y=1+o,s.current=r,s.blockwide=o):(a=Math.max(1,Math.min(r-s.current,o-s.blockwide)+1),y=s.inactive?a+s.blockwide:Math.min(a+s.blockwide,1+o)));b--;){c=0;l=s.fstack[b];switch(l.ftype){case"left":c=l.fpos<a;break;case"right":c=y<=o-s.rights+l.fpos;break;case"first":c=s.current<r;break;case"last":c=s.blockwide<s.current+o-r;break;case"prev":c=1<r;break;case"next":c=r<o}d|=c<<l.fgroup}for(u={number:v,lapping:p,pages:o,perpage:h.perpage,page:r,slice:[(c=r*(h.perpage-p)+p)-h.perpage,Math.min(c,v)]},w="";++b<g;){l=s.fstack[b];c=d>>l.fgroup&1;switch(l.ftype){case"block":for(;a<y;++a)u.value=a,u.pos=1+s.blockwide-y+a,u.active=a<=o||v<0,u.first=1===a,u.last=a===o&&0<v,k(h,u,l.ftype);continue;case"left":u.value=l.fpos;u.active=l.fpos<a;break;case"right":u.value=o-s.rights+l.fpos;u.active=y<=u.value;break;case"first":u.value=1;u.active=c&&1<r;break;case"prev":(u.active=h.circular)?u.value=r===1?o:r-1:(u.value=Math.max(1,r-1),u.active=c&&1<r);break;case"last":(u.active=v<0)?u.value=1+r:(u.value=o,u.active=c&&r<o);break;case"next":(u.active=h.circular)?u.value=1+r%o:(u.active=v<0)?u.value=1+r:(u.value=Math.min(1+r,o),u.active=c&&r<o);break;case"leap":case"fill":u.pos=l.fpos;u.active=c;k(h,u,l.ftype);continue}u.pos=l.fpos;u.last=u.first=i;k(h,u,l.ftype)}return e.length&&(n("a",e.html(w)).click(h.onClick||function(i){i.preventDefault();var r=this;do if("a"===r.nodeName.toLowerCase())break;while(r=r.parentNode);f.setPage(n(r).data("page"));f.locate&&(t.location=r.href)}),f.locate=h.onSelect.call({number:v,lapping:p,pages:o,slice:u.slice},r,e)),f}};return f.setNumber(r).setOptions(u).setPage()}})(jQuery,this);